<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>APItools Middleware Documentation</title>
    <link rel="stylesheet" href="ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>APItools</h1>


<h2>Contents</h2>
<ul>
<li><a href="#Bucket">Bucket</a></li>
<li><a href="#Console">Console</a></li>
<li><a href="#Functions">Functions</a></li>
<li><a href="#Tables">Tables</a></li>
<li><a href="#Class_Trace">Class Trace </a></li>
<li><a href="#Class_Event">Class Event </a></li>
<li><a href="#Class_Console">Class Console </a></li>
<li><a href="#Class_Bucket">Class Bucket </a></li>
</ul>


<h2>Modules</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><strong>middleware</strong></li>
</ul>

</div>

<div id="content">

<h1>Module <code>middleware</code></h1>
<p>APItools Middleware
<p> Middleware documentation of APItools.</p>
<p>
 All this should be available when middleware is evaluated.
</p>
    <h3>Info:</h3>
    <ul>
        <li><strong>Copyright</strong>: APItools 2014</li>
        <li><strong>License</strong>: MIT</li>
    </ul>


<h2><a href="#Bucket">Bucket</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#bucket.middleware">bucket.middleware</a></td>
	<td class="summary">Middleware Bucket
 Every middleware has own bucket.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#bucket.service">bucket.service</a></td>
	<td class="summary">Service Bucket
 Every service has own bucket.</td>
	</tr>
</table>
<h2><a href="#Console">Console</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#console">console</a></td>
	<td class="summary">console like in the browser
 see <a href="index.html#Console">Console</a> for all the available methods</td>
	</tr>
</table>
<h2><a href="#Functions">Functions</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#log">log (...)</a></td>
	<td class="summary">Simple debugging function that inspects the object and prints them to a logfile.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#metric.count">metric.count ()</a></td>
	<td class="summary">store integer values</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#metric.set">metric.set ()</a></td>
	<td class="summary">store scalar values</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#base64.decode">base64.decode (str)</a></td>
	<td class="summary">decode base64
 Decodes the str argument as a base64 digest to the raw form.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#base64.encode">base64.encode (str)</a></td>
	<td class="summary">encode base64
 Encode str to a base64 digest.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#send.email">send.email (to, subject, msg)</a></td>
	<td class="summary">Send email</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#send.event">send.event (event)</a></td>
	<td class="summary">Create event
 Creates <a href="index.html#Event">Event</a></td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#send.notification">send.notification (event)</a></td>
	<td class="summary">Create middleware notification
 Creates <a href="index.html#Event">Event</a> and will be overriden to middleware channel.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#time.seconds">time.seconds ()</a></td>
	<td class="summary">Current time in seconds
 Returns the elapsed seconds from the epoch.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#time.http">time.http (sec)</a></td>
	<td class="summary">Formats number of seconds to a stirng
 Returns a formated string can be used as the
 http header time (for example, being used in Last-Modified header).</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#time.now">time.now ()</a></td>
	<td class="summary">Returns a floating-point number for the elapsed time in seconds
 (including milliseconds as the decimal part) from the epoch for the current time stamp.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#json.encode">json.encode (object)</a></td>
	<td class="summary">JSON Encode
 Encodes given table to a JSON.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#json.decode">json.decode (string)</a></td>
	<td class="summary">JSON Decode
 Decodes JSON to an object.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#hmac.sha256">hmac.sha256 (str, key)</a></td>
	<td class="summary">HMAC-SHA-256
 create keyed-hash message authentication code by SHA-256 hashing function</td>
	</tr>
</table>
<h2><a href="#Tables">Tables</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#trace">trace</a></td>
	<td class="summary">Trace
 <a href="index.html#Trace">Trace</a> object of current request</td>
	</tr>
</table>
<h2><a href="#Class_Trace">Class Trace </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#trace.req">trace.req</a></td>
	<td class="summary">req
 request</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#trace.uuid">trace.uuid</a></td>
	<td class="summary">uuid
 unique identifier</td>
	</tr>
</table>
<h2><a href="#Class_Event">Class Event </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#event.channel">event.channel</a></td>
	<td class="summary">channel
 required attribute, can be for example middleware, email, stats, ...</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#event.level">event.level</a></td>
	<td class="summary">level
 one of the {'log', 'debug', 'info', 'warn', 'error' }</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#event.msg">event.msg</a></td>
	<td class="summary">msg
 required attribute, a message of the event</td>
	</tr>
</table>
<h2><a href="#Class_Console">Class Console </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#console.log">console.log (...)</a></td>
	<td class="summary">log</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#console.debug">console.debug (...)</a></td>
	<td class="summary">debug</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#console.info">console.info (...)</a></td>
	<td class="summary">info</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#console.warn">console.warn (...)</a></td>
	<td class="summary">warn</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#console.error">console.error (...)</a></td>
	<td class="summary">error</td>
	</tr>
</table>
<h2><a href="#Class_Bucket">Class Bucket </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#bucket.get">bucket.get (field_name)</a></td>
	<td class="summary">get a value</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#bucket.get">bucket.get (field_name, value, exptime)</a></td>
	<td class="summary">set a value</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#bucket.delete">bucket.delete (field_name)</a></td>
	<td class="summary">delete a value</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#bucket.incr">bucket.incr (field_name, amount)</a></td>
	<td class="summary">increment a value</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#bucket.add">bucket.add (field_name, value, exptime)</a></td>
	<td class="summary">set the value if it does not exist</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#bucket.delete_all">bucket.delete_all ()</a></td>
	<td class="summary">delete all values</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#bucket.get_keys">bucket.get_keys ()</a></td>
	<td class="summary">get all keys</td>
	</tr>
</table>

<br/>
<br/>


    <h2><a name="Bucket"></a>Bucket</h2>

    <dl class="function">
    <dt>
    <a name = "bucket.middleware"></a>
    <strong>bucket.middleware</strong>
    </dt>
    <dd>
    Middleware Bucket
 Every middleware has own bucket.  You can access it by using methods of <a href="index.html#Bucket">Bucket</a>.







</dd>
    <dt>
    <a name = "bucket.service"></a>
    <strong>bucket.service</strong>
    </dt>
    <dd>
    Service Bucket
 Every service has own bucket.  All middlewares can access it by using <a href="index.html#Bucket">Bucket</a>.







</dd>
</dl>
    <h2><a name="Console"></a>Console</h2>

    <dl class="function">
    <dt>
    <a name = "console"></a>
    <strong>console</strong>
    </dt>
    <dd>
    console like in the browser
 see <a href="index.html#Console">Console</a> for all the available methods







</dd>
</dl>
    <h2><a name="Functions"></a>Functions</h2>

    <dl class="function">
    <dt>
    <a name = "log"></a>
    <strong>log (...)</strong>
    </dt>
    <dd>
    Simple debugging function that inspects the object and prints them to a logfile.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a> or <a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.5">table</a></span>
         any number of parameters
        </li>
    </ul>





</dd>
    <dt>
    <a name = "metric.count"></a>
    <strong>metric.count ()</strong>
    </dt>
    <dd>
    store integer values







</dd>
    <dt>
    <a name = "metric.set"></a>
    <strong>metric.set ()</strong>
    </dt>
    <dd>
    store scalar values







</dd>
    <dt>
    <a name = "base64.decode"></a>
    <strong>base64.decode (str)</strong>
    </dt>
    <dd>
    decode base64
 Decodes the str argument as a base64 digest to the raw form.  Returns nil if str is not well formed.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
         base64 encoded string
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types">optional <a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
        decoded string
    </ol>




</dd>
    <dt>
    <a name = "base64.encode"></a>
    <strong>base64.encode (str)</strong>
    </dt>
    <dd>
    encode base64
 Encode str to a base64 digest.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
         a string
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
        base64 encoded string
    </ol>




</dd>
    <dt>
    <a name = "send.email"></a>
    <strong>send.email (to, subject, msg)</strong>
    </dt>
    <dd>
    Send email


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">to</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
         email address of the receiver
        </li>
        <li><span class="parameter">subject</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
         email subject
        </li>
        <li><span class="parameter">msg</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
         the email body
        </li>
    </ul>





</dd>
    <dt>
    <a name = "send.event"></a>
    <strong>send.event (event)</strong>
    </dt>
    <dd>
    Create event
 Creates <a href="index.html#Event">Event</a>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">event</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.5">table</a></span>
         the event to be created
        </li>
    </ul>





</dd>
    <dt>
    <a name = "send.notification"></a>
    <strong>send.notification (event)</strong>
    </dt>
    <dd>
    Create middleware notification
 Creates <a href="index.html#Event">Event</a> and will be overriden to middleware channel.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">event</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.5">table</a></span>
         the event to be created
        </li>
    </ul>





</dd>
    <dt>
    <a name = "time.seconds"></a>
    <strong>time.seconds ()</strong>
    </dt>
    <dd>
    Current time in seconds
 Returns the elapsed seconds from the epoch.



    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">int</span></span>
        elapsed seconds from the epoch
    </ol>




</dd>
    <dt>
    <a name = "time.http"></a>
    <strong>time.http (sec)</strong>
    </dt>
    <dd>
    Formats number of seconds to a stirng
 Returns a formated string can be used as the
 http header time (for example, being used in Last-Modified header).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">sec</span>
            <span class="types"><span class="type">int</span></span>
         timestamp in seconds (like those returned from time.seconds)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
        formatted string
    </ol>




</dd>
    <dt>
    <a name = "time.now"></a>
    <strong>time.now ()</strong>
    </dt>
    <dd>
    Returns a floating-point number for the elapsed time in seconds
 (including milliseconds as the decimal part) from the epoch for the current time stamp.



    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">float</span></span>
        elapsed seconds from the epoch (including miliseconds)
    </ol>




</dd>
    <dt>
    <a name = "json.encode"></a>
    <strong>json.encode (object)</strong>
    </dt>
    <dd>
    JSON Encode
 Encodes given table to a JSON.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">object</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.5">table</a></span>
         to be serialized
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
        JSON string
    </ol>




</dd>
    <dt>
    <a name = "json.decode"></a>
    <strong>json.decode (string)</strong>
    </dt>
    <dd>
    JSON Decode
 Decodes JSON to an object.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">string</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
         to be deserialized
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.5">table</a></span>
        deserialized object
    </ol>




</dd>
    <dt>
    <a name = "hmac.sha256"></a>
    <strong>hmac.sha256 (str, key)</strong>
    </dt>
    <dd>
    HMAC-SHA-256
 create keyed-hash message authentication code by SHA-256 hashing function


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
         string to be signed
        </li>
        <li><span class="parameter">key</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
         to sign it with
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
        digest
    </ol>




</dd>
</dl>
    <h2><a name="Tables"></a>Tables</h2>

    <dl class="function">
    <dt>
    <a name = "trace"></a>
    <strong>trace</strong>
    </dt>
    <dd>
    Trace
 <a href="index.html#Trace">Trace</a> object of current request







</dd>
</dl>
    <h2><a name="Class_Trace"></a>Class Trace </h2>

        Trace
    <dl class="function">
    <dt>
    <a name = "trace.req"></a>
    <strong>trace.req</strong>
    </dt>
    <dd>
    req
 request







</dd>
    <dt>
    <a name = "trace.uuid"></a>
    <strong>trace.uuid</strong>
    </dt>
    <dd>
    uuid
 unique identifier







</dd>
</dl>
    <h2><a name="Class_Event"></a>Class Event </h2>

        Event
    <dl class="function">
    <dt>
    <a name = "event.channel"></a>
    <strong>event.channel</strong>
    </dt>
    <dd>
    channel
 required attribute, can be for example middleware, email, stats, ...







</dd>
    <dt>
    <a name = "event.level"></a>
    <strong>event.level</strong>
    </dt>
    <dd>
    level
 one of the {'log', 'debug', 'info', 'warn', 'error' }







</dd>
    <dt>
    <a name = "event.msg"></a>
    <strong>event.msg</strong>
    </dt>
    <dd>
    msg
 required attribute, a message of the event







</dd>
</dl>
    <h2><a name="Class_Console"></a>Class Console </h2>

        Console
    <dl class="function">
    <dt>
    <a name = "console.log"></a>
    <strong>console.log (...)</strong>
    </dt>
    <dd>
    log


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
         objects to be printed
        </li>
    </ul>





</dd>
    <dt>
    <a name = "console.debug"></a>
    <strong>console.debug (...)</strong>
    </dt>
    <dd>
    debug


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
         objects to be printed
        </li>
    </ul>





</dd>
    <dt>
    <a name = "console.info"></a>
    <strong>console.info (...)</strong>
    </dt>
    <dd>
    info


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
         objects to be printed
        </li>
    </ul>





</dd>
    <dt>
    <a name = "console.warn"></a>
    <strong>console.warn (...)</strong>
    </dt>
    <dd>
    warn


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
         objects to be printed
        </li>
    </ul>





</dd>
    <dt>
    <a name = "console.error"></a>
    <strong>console.error (...)</strong>
    </dt>
    <dd>
    error


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
         objects to be printed
        </li>
    </ul>





</dd>
</dl>
    <h2><a name="Class_Bucket"></a>Class Bucket </h2>

        Bucket
    <dl class="function">
    <dt>
    <a name = "bucket.get"></a>
    <strong>bucket.get (field_name)</strong>
    </dt>
    <dd>
    get a value


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">field_name</span>
         name
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        value previously stored
    </ol>




</dd>
    <dt>
    <a name = "bucket.get"></a>
    <strong>bucket.get (field_name, value, exptime)</strong>
    </dt>
    <dd>
    set a value


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">field_name</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
         key name
        </li>
        <li><span class="parameter">value</span>
         value
        </li>
        <li><span class="parameter">exptime</span>
            <span class="types"><span class="type">int</span></span>
         time to expire in seconds
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        value previously stored
    </ol>




</dd>
    <dt>
    <a name = "bucket.delete"></a>
    <strong>bucket.delete (field_name)</strong>
    </dt>
    <dd>
    delete a value


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">field_name</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
         a key
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        value previously stored
    </ol>




</dd>
    <dt>
    <a name = "bucket.incr"></a>
    <strong>bucket.incr (field_name, amount)</strong>
    </dt>
    <dd>
    increment a value


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">field_name</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
         a key
        </li>
        <li><span class="parameter">amount</span>
            <span class="types"><span class="type">number</span></span>
         amount to increment/decrement (default 1)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        value previously stored
    </ol>




</dd>
    <dt>
    <a name = "bucket.add"></a>
    <strong>bucket.add (field_name, value, exptime)</strong>
    </dt>
    <dd>
    set the value if it does not exist


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">field_name</span>
            <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">string</a></span>
         a key
        </li>
        <li><span class="parameter">value</span>
         value
        </li>
        <li><span class="parameter">exptime</span>
            <span class="types"><span class="type">int</span></span>
         expire time in seconds
        </li>
    </ul>





</dd>
    <dt>
    <a name = "bucket.delete_all"></a>
    <strong>bucket.delete_all ()</strong>
    </dt>
    <dd>
    delete all values







</dd>
    <dt>
    <a name = "bucket.get_keys"></a>
    <strong>bucket.get_keys ()</strong>
    </dt>
    <dd>
    get all keys



    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="http://www.lua.org/manual/5.2/manual.html#6.4">{string,</a></span>
        ...} all keys
    </ol>




</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.3</a></i>
<i style="float:right;">Last updated 2014-11-14 16:11:29 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
